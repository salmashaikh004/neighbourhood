<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My Profile</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#f6faf6;
  --page:#e9f2ea;
  --card:#ffffff;
  --text:#153223;
  --muted:#5b7a6b;
  --accent:#cfe2d5;
}

body{
  margin:0;
  font-family:Inter, Arial, sans-serif;
  background:var(--bg);
  color:var(--text);
  display:flex;
  justify-content:center;
}

.page{
  width:320px;
  min-height:80vh;
  background:linear-gradient(180deg,#dfeee2,#eef6ef);
  padding:20px;
  border-radius:28px;
}

/* top bar */
.top{
  display:flex;
  align-items:center;
  gap:10px;
  margin-bottom:20px;
}

.back{
  font-size:20px;
  cursor:pointer;
}

h1{
  font-family:Merriweather, serif;
  font-size:22px;
  margin:0;
}

/* profile card */
.profile-box{
  background:var(--card);
  border-radius:20px;
  padding:24px;
  text-align:center;
  box-shadow:0 6px 14px rgba(0,0,0,0.04);
}

.avatar{
  width:90px;
  height:90px;
  border-radius:50%;
  background:var(--accent);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:36px;
  margin:0 auto 14px auto;
}

.name{
  font-size:20px;
  font-weight:700;
  margin-bottom:6px;
}
#profileLocation{
  font-size:13px;
  line-height:1.4;
}

.info{
  font-size:14px;
  color:var(--muted);
  margin-top:6px;
}
.badges{
  margin-top:8px;
}

.badge{
  display:inline-block;
  padding:6px 10px;
  border-radius:12px;
  font-size:11px;
  font-weight:600;
}

.badge.verified{
  background:#d8f0dc;
  color:#2f7d4f;
}
.profile-box{
  transition:0.3s;
}

.profile-box:hover{
  transform:translateY(-2px);
}

</style>
</head>

<body>

<div class="page">

  <!-- HEADER -->
  <div class="top">
    <div class="back" onclick="history.back()">←</div>
    <h1>My Profile</h1>
  </div>

  <!-- PROFILE -->
  <div class="profile-box">
    <div class="avatar">👤</div>

    <div class="name" id="profileName"></div>
    <div class="email" id="profileEmail"></div>

    <div class="info" id="profileLocation"></div>
    <div class="info" id="profileSince"></div>
  </div>

<div class="badges">
  <span class="badge verified" style="display:none;">✔ Verified</span>
</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDZU8DY5BYvU6UDFx9ry-VlwY70nA_mWdk",
  authDomain: "neighbourhood-app-d2ec2.firebaseapp.com",
  projectId: "neighbourhood-app-d2ec2"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* ===== GET UID FROM URL ===== */

const urlParams = new URLSearchParams(window.location.search);
const profileUid = urlParams.get("uid");

onAuthStateChanged(auth, async (loggedUser) => {

  if (!loggedUser) {
    window.location.href = "signin.html";
    return;
  }

 let uidToLoad = loggedUser.uid;

if (
  profileUid &&
  profileUid !== "undefined" &&
  profileUid !== "null" &&
  profileUid.length > 10
) {
  uidToLoad = profileUid;
} // ✅ FIX

  const avatarDiv = document.querySelector(".avatar");

  const userDoc = await getDoc(doc(db, "users", uidToLoad));

  if (!userDoc.exists()) return;

  const data = userDoc.data();

  const bioText = data.bio || "No bio added";
  const photoUrl = data.photoURL || data.photo || "";
  const locationText = data.location?.address || "Not set";

  /* ===== Avatar ===== */
  if (photoUrl) {
    avatarDiv.innerHTML =
      `<img src="${photoUrl}"
       style="width:100%;height:100%;object-fit:cover;border-radius:50%;">`;
  } else {
    avatarDiv.innerText =
      data.displayName
        ? data.displayName.charAt(0).toUpperCase()
        : "U";
  }

  /* ===== Name ===== */
  document.getElementById("profileName").innerText =
    data.displayName || "No Name";

  /* ===== Email ===== */
  document.getElementById("profileEmail").innerText =
    data.email || "";

  /* ===== Bio ===== */
  const bioElement = document.createElement("div");
  bioElement.className = "info";
  bioElement.innerText = bioText;
  document.getElementById("profileEmail").after(bioElement);

  /* ===== Location ===== */
  document.getElementById("profileLocation").innerText =
    "Location: " + locationText;

  /* ===== Member Since ===== */
  if (data.createdAt?.seconds) {
    const joinDate = new Date(data.createdAt.seconds * 1000);
    document.getElementById("profileSince").innerText =
      "Member since: " + joinDate.getFullYear();
  } else {
    const joinDate = new Date(loggedUser.metadata.creationTime);
    document.getElementById("profileSince").innerText =
      "Member since: " + joinDate.getFullYear();
  }

  /* ===== Verified Badge ===== */
  const badge = document.querySelector(".badge.verified");

  if (profileUid && profileUid !== loggedUser.uid) {
    badge.style.display = data.emailVerified ? "inline-block" : "none";
  } else {
    badge.style.display = loggedUser.emailVerified ? "inline-block" : "none";
  }

});

</script>
</body>
</html>


