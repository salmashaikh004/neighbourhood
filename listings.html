<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Borrowed Items</title>

<link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

<style>
:root{
  --page:#e6f0e8;
  --panel:#dbeadb;
  --card:#ffffff;
  --accent:#8aa98a;
  --text:#123326;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:var(--page);
  font-family:Inter;
  display:flex;
  justify-content:center;
  padding:20px;
}
.app{
  width:320px;
  height:600px;
  background:linear-gradient(180deg,var(--panel),#e4f0e6);
  border-radius:28px;
  padding:18px;
  display:flex;
  flex-direction:column;
}
.header{
  display:flex;
  align-items:center;
  gap:10px;
  margin-bottom:16px;
}
.back{font-size:18px;cursor:pointer;}
h1{
  font-family:Merriweather;
  font-size:22px;
  margin:0;
}
.list{
  flex:1;
  background:var(--card);
  border-radius:18px;
  padding:14px;
  display:flex;
  flex-direction:column;
  overflow:auto;
}
.empty{
  margin:auto;
  text-align:center;
  font-size:13px;
  opacity:0.6;
}
.item{
  background:#f4faf4;
  border-radius:14px;
  padding:12px;
  margin-bottom:10px;
}
.item-title{
  font-weight:600;
  margin-bottom:4px;
}
.item-sub{
  font-size:12px;
  opacity:0.6;
}
.status{
  margin-top:6px;
  font-size:11px;
  padding:4px 8px;
  border-radius:10px;
  display:inline-block;
  font-weight:600;
}
.active{ background:#d8f0dc; color:#2f7d4f; }
.approved{ background:#d8f0dc; color:#2f7d4f; }
.overdue{ background:#ffd6d6; color:#c0392b; }
.completed{ background:#e0e0e0; color:#555; }
.pending{ background:#fff3cd; color:#8a6d3b; }
</style>
</head>

<body>

<div class="app">

  <div class="header">
    <div class="back" onclick="location.href='borrow-dashboard.html'">←</div>
    <h1>My Borrowed Items</h1>
  </div>

  <div class="list" id="borrowContainer"></div>

</div>

<script>
// Use Django API for requests/listings
const container = document.getElementById('borrowContainer');

async function ensureAuth(){
  const r = await fetch('/api/whoami/');
  if(r.status === 401){ window.location.href = 'signin.html'; return false; }
  return true;
}

async function loadListings(){
  const ok = await ensureAuth();
  if(!ok) return;
  const res = await fetch('/api/requests/');
  const data = await res.json();
  const sent = data.sent || [];
  container.innerHTML = '';
  if(sent.length === 0){
    container.innerHTML = `<div class="empty">You haven’t borrowed anything yet.</div>`;
    return;
  }
  sent.forEach(item => {
    const card = document.createElement('div');
    card.className = 'item';
    const statusClass = item.status || 'pending';
    card.innerHTML = `
      <div class="item-title">${item.item_name || 'Item'}</div>
      <div class="item-sub">Owner: ${item.receiver || 'Unknown'}</div>
      <div class="status ${statusClass}">${item.status || 'pending'}</div>
    `;
    container.appendChild(card);
  });
}

loadListings();
</script>

</body>
</html>